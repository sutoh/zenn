---
title: "Alibaba Cloud Platform for AI ã®å°å…¥ã¨LangChainï¼ˆPAI-EASï¼‰ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹"
emoji: "ğŸš€"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["alibaba", "cloud", "ai"]
published: true
---
AIã®ä¸–ç•Œã¯æ—¥é€²æœˆæ­©ã§é€²åŒ–ã—ã¦ãŠã‚Šã€ãã‚Œã‚’æ”¯ãˆã‚‹æŠ€è¡“ã¨ã—ã¦å„ç¤¾ã‹ã‚‰æ§˜ã€…ãªãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ãŒæä¾›ã•ã‚Œã¦ã„ã¾ã™ã€‚Azureã®Azure Machine Learningã€AWSã®Amazon SageMakerã€GCPã®AI PlatformãŒå­˜åœ¨ã—ã¦ã„ã¾ã™ãŒã€ç§ãŒä»Šæ³¨ç›®ã—ã¦ã„ã‚‹ã®ã¯Alibaba Cloudã®AIãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã€[Alibaba Cloud Platform for AI](https://www.alibabacloud.com/product/machine-learning?spm=a2c65.11461447.0.0.326b1503lshnPs)Â (PAI)ã§ã™ã€‚æ—¥æœ¬ã§ã¯ã¾ã é¦´æŸ“ã¿ã®å°‘ãªã„ã“ã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ãŒã©ã®ã‚ˆã†ãªã‚‚ã®ãªã®ã‹ã€ã©ã‚“ãªæ©Ÿèƒ½ã‚’æŒã£ã¦ã„ã‚‹ã®ã‹ã‚’èª¿ã¹ã¦ã¿ã¾ã—ãŸã€‚

## PAI ã®ç‰¹å¾´

PAIã¯ 2018å¹´ã‹ã‚‰å­˜åœ¨ã—ã¦ãŠã‚Šã€2021å¹´4æœˆã«ã¯ã‚½ãƒ•ãƒˆãƒãƒ³ã‚¯ã«ã¦PAIã®æ¦‚è¦ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚åŸºæœ¬çš„ã«ã¯ã€æ©Ÿæ¢°å­¦ç¿’ï¼ˆMachine Learningï¼‰ã‚„æ·±å±¤å­¦ç¿’ï¼ˆDeep Learningï¼‰ã‚’è¡Œã†ãŸã‚ã®ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã¨ãªã£ã¦ã„ã¾ã™ã€‚ ä½¿ã„ã‚„ã™ãã€ã‚³ã‚¹ãƒˆåŠ¹ç‡ãŒé«˜ãã€æ‹¡å¼µæ€§ãŒã‚ã‚Šã€ä¼æ¥­ã‚„é–‹ç™ºè€…å‘ã‘ã®æ©Ÿæ¢°å­¦ç¿’ãƒ»æ·±å±¤å­¦ç¿’ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã™ã€‚

[https://www.softbank.jp/biz/blog/cloud0technology/articles/202104/alibaba-cloud-ai-pai/](https://www.softbank.jp/biz/blog/cloud-technology/articles/202104/alibaba-cloud-ai-pai/) 

ä¸‹è¨˜ãŒãƒ¡ã‚¤ãƒ³ã®æ©Ÿèƒ½ã¨ãªã‚‹ã‚ˆã†ã§ã™ã€‚

- ãƒ‡ãƒ¼ã‚¿ãƒ©ãƒ™ãƒªãƒ³ã‚°(PAI-iTAG)
- ãƒ¢ãƒ‡ãƒ«æ§‹ç¯‰
    - PAIãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼(PAI-Designer)
    - (PAI-DSW)
- ãƒ¢ãƒ‡ãƒ«ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°(PAI-DLC)
- ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã®æœ€é©åŒ–ãŠã‚ˆã³æ¨è«–ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ(PAI-EAS)

ãªã©ã€AIã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ã®å…¨ãƒ—ãƒ­ã‚»ã‚¹ã‚’ã‚«ãƒãƒ¼ã—ã¦ã„ã¾ã™ã€‚

2023å¹´ã«ã¯ã€æ›´ãªã‚‹å¤§è¦æ¨¡è¨€èªãƒ¢ãƒ‡ãƒ«ã®é€²åŒ–ã‚„ç”ŸæˆAIã®çˆ†ç™ºçš„ãªé€²åŒ–ã«ã‚ˆã‚Šã€ç”ŸæˆAIï¼ˆGenerative AIï¼‰ã«ã¤ã„ã¦ã‚‚ä¸‹è¨˜ã®ã‚ˆã†ãªã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆãŒç¶šã‘ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚ä¸»ã«PAI-EASãŒã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã™ã€‚

- **EAS ã§ã® LLM ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ—ãƒ­ã‚¤**
    
    [Deploy LLM applications in EAS - Platform For AI - Alibaba Cloud Documentation Center](https://www.alibabacloud.com/help/en/pai/use-cases/deploy-llm-in-eas)
    
- **EAS ã§ã® AI ãƒšã‚¤ãƒ³ãƒˆç”¨ã® Stable Diffusion ã‚’è¿…é€Ÿã«å°å…¥ã™ã‚‹**
    
    [Deploy Stable Diffusion by using EAS - Platform For AI - Alibaba Cloud Documentation Center](https://www.alibabacloud.com/help/en/pai/use-cases/deploy-stable-diffusion-for-ai-image-generation)
    
- **PAIã¨ãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’åˆ©ç”¨ã—ã€LLMã‚’åŸºã«é«˜åº¦ãªä¼šè©±æ©Ÿèƒ½ã‚’å®Ÿè£…**
    
    [Use PAI and a vector database to implement intelligent dialogue based on LLMs - Platform For AI - Alibaba Cloud Documentation Center](https://www.alibabacloud.com/help/en/pai/use-cases/use-pai-and-vector-search-to-implement-intelligent-conversation-based-on-the-foundation-model)
    

ä»Šå›ã¯ã€ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã•ã‚ŒãŸç”ŸæˆAIã‚’åˆ©ç”¨ã™ã‚‹PAI-EASã§ã®LangChainã‚’å­¦ã‚“ã§ã„ãã¾ã™ã€‚

## PAI ã® Activate

PAIã‚’åˆ©ç”¨ã™ã‚‹ç‚ºã«Activateä½œæ¥­ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚

Alibaba Cloudã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ã¦ã€PAIã®ç”»é¢ã¸ç§»å‹•ã—ã¾ã™ã€‚

[https://pai.console.aliyun.com/?regionId=cn-shanghai#/workspace/welcome](https://pai.console.aliyun.com/?regionId=cn-shanghai#/workspace/welcome)

æ—¥æœ¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ãŒå­˜åœ¨ã—ãªã„ç‚ºã€ä¸Šæµ·ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã‚’é¸æŠã—ã¾ã—ãŸã€‚

`Activate  Platform for AI and create a default workspace` ã§ã‚µã‚¤ãƒ‰ãƒãƒ¼ãŒå‡ºã¦ãã¾ã™ã€‚

![pai001.png](/images/tried-PAI-EAS/pai001.png)

å„å¿…è¦ãªé …ç›®ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¦ã„ãã¾ã™ã€‚

`RAM Role Authorization` ã® `Authorize Now` ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã€ã‚¯ãƒ©ã‚¦ãƒ‰ãƒªã‚½ãƒ¼ã‚¹ã®ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã‚’ã—ã¦ã„ãã¾ã™ã€‚

![pai002.png](/images/tried-PAI-EAS/pai002.png)

`è¨±å¯ã«åŒæ„` ãƒœã‚¿ãƒ³ã§è¨±å¯ã—ã¦ã„ãã¾ã™ã€‚

![pai003.png](/images/tried-PAI-EAS/pai003.png)

`Activate and Create Default Workspace` ã‚’æŠ¼ã—ã¦ã„ãã¾ã™ã€‚

Workspace ãŒä½œæˆå®Œäº†ã—ã€ `Go to Default Workspace` ã§ç§»å‹•ã—ã¦ã„ãã¾ã™ã€‚

![004.png](/images/tried-PAI-EAS/004.png)

## PASâˆ’EASã®æ§‹ç¯‰

`Platform for AI` ã®ãƒšãƒ¼ã‚¸ã«ç§»å‹•ã—ã€EASã‚’é–‹å§‹ã—ã¦ã„ãã¾ã™ã€‚

![005.png](/images/tried-PAI-EAS/005.png)

EASã«å¿…è¦ãªè¨±å¯ã‚’è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

![006.png](/images/tried-PAI-EAS/006.png)

ä»Šå›ã¯PAI-EASã‚’åˆ©ç”¨ã™ã‚‹ã®ã§ã€ `EAS-Online ModelServices`ã«ã¦ã€`Deploy Service` ã‚’é¸æŠã—ã€ `Select Deployment Mode` ã«ã¦ `Custom Deployment` ã‚’é¸æŠã—ã¦ã€ `OK` ã‚’æŠ¼ã—ã¾ã™ã€‚

![008.png](/images/tried-PAI-EAS/008.png)

[ãƒœãƒ„](https://www.notion.so/0bb4dd9d22604822842f70a912c1a594?pvs=21)

Deploy Serviceã®ç”»é¢ã«ã¦ã€ä¸‹è¨˜ã®ã‚ˆã†ã«å…¥åŠ›ã—ã¦ã„ãã¾ã™ã€‚

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | èª¬æ˜ |
| --- | --- |
| Service Name | ã‚µãƒ¼ãƒ“ã‚¹ã®åå‰ã€‚
test_langchain |
| Deployment Method | Deploy Service by Using Image ã‚’é¸æŠã—ã¾ã™ã€‚ |
| Select Image | PAI Image ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒªã‚¹ãƒˆã‹ã‚‰ chat-llm-webui ã‚’é¸æŠã—ã€ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨ã—ã¦ 3.0 ã‚’é¸æŠã—ã¾ã™ã€‚ |
| Command to Run | ä»Šå›åˆ©ç”¨ã™ã‚‹ã®ã¯llama2ãªã®ã§ã€ä¸‹è¨˜ã‚’æŒ‡å®šã€‚
ã‚³ãƒãƒ³ãƒ‰ï¼š python webui/webui_server.py --port=8000 --model-path=meta-llama/Llama-2-7b-chat-hf
ãƒãƒ¼ãƒˆç•ªå· 8000 |
| Resource Group Type | Public Resource Group ã‚’é¸æŠã—ã¾ã™ã€‚ |
| Resource Configuration Mode | General ã‚’é¸æŠã—ã¾ã™ã€‚ |
| Resource Configuration | GPU ã‚¿ãƒ–ã§Instance Typeã‚’é¸æŠã—ã¾ã™ã€‚ã‚³ã‚¹ãƒˆåŠ¹ç‡ã®è¦³ç‚¹ã‹ã‚‰ã€ ecs.gn6i-c4g1.xlarge ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ—ã®ä½¿ç”¨ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚ |
| VPC | åˆ©ç”¨å¯èƒ½ãªVPCã‚’è¨­å®šã™ã‚‹ |

llama2ã‚’åˆ©ç”¨ã™ã‚‹éš›ã€ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®æ¡é …ãŠã‚ˆã³ãƒãƒªã‚·ãƒ¼ã«åŒæ„ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§ã€ `the official Meta website` ã®ãƒªãƒ³ã‚¯ã‹ã‚‰åŒæ„ã—ã«è¡Œãã¾ã™ã€‚

`Deploy` ã§å®Ÿè¡Œã—ã¾ã™ã€‚

![011.png](/images/tried-PAI-EAS/011.png)

ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†ã™ã‚‹ã¨ã€ `Running` è¡¨è¨˜ã•ã‚Œã¾ã™ã€‚

![012.png](/images/tried-PAI-EAS/012.png)

## LangChain ã®ç¹‹ãè¾¼ã¿

ã“ã“ã¾ã§ã§ã€PAIã«ã¦LangChainã®æº–å‚™ãŒæ•´ã£ãŸã®ã§ã€Alibaba Cloud PAI EAS ã‚’åˆ©ç”¨ã—ãŸLangChainãŒä½¿ãˆã‚‹ã‹ã‚’ç¢ºèªã—ã¦ã„ãã¾ã™ã€‚

LangChainã®å…¬å¼ã«ã‚µãƒ³ãƒ—ãƒ«ãŒã‚ã‚‹ã®ã§ã€è©¦ã—ã¦ã„ãã¾ã™ã€‚

[https://python.langchain.com/docs/integrations/chat/alibaba_cloud_pai_eas](https://python.langchain.com/docs/integrations/chat/alibaba_cloud_pai_eas)

langchainã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã€ä¸‹è¨˜ã‚’å®Ÿè¡Œã—ã¦ã„ãã¾ã™ã€‚

```python
import os
from langchain.chains import LLMChain
from langchain.prompts import PromptTemplate
from langchain_community.llms.pai_eas_endpoint import PaiEasEndpoint

os.environ["EAS_SERVICE_URL"] = "Your_EAS_Service_URL"
os.environ["EAS_SERVICE_TOKEN"] = "Your_EAS_Service_Token"

template = """Question: {question}

Answer: Let's think step by step."""

prompt = PromptTemplate.from_template(template)
llm = PaiEasEndpoint(
    eas_service_url=os.environ["EAS_SERVICE_URL"],
    eas_service_token=os.environ["EAS_SERVICE_TOKEN"],
)

llm_chain = prompt | llm
question = "What NFL team won the Super Bowl in the year Justin Beiber was born?"
llm_chain.invoke({"question": question})
```

```python
' Thank you for asking! However, I must respectfully point out that the question contains an error. Justin Bieber was born in 1994, and the Super Bowl was first played in 1967. Therefore, it is not possible for any NFL team to have won the Super Bowl in the year Justin Bieber was born.\n\nI hope this clarifies things! If you have any other questions, please feel free to ask.'
```

å•ã„ã‹ã‘ã«ç­”ãˆã¦ãã‚Œã¾ã—ãŸï¼

## PAI ã®é‡‘é¡æ„Ÿ

åˆ©ç”¨ã™ã‚‹ä¸Šã§é‡è¦–ã™ã‚‹ç‚¹ã¯ã‚„ã¯ã‚Šé‡‘é¡ã¯æŠ‘ãˆã¦ãŠããŸã„ãƒã‚¤ãƒ³ãƒˆã«ãªã‚Šã¾ã™ãŒã€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ç¨¼åƒåˆ†ã®å¾“é‡èª²é‡‘åˆ¶ã¨ãªã£ã¦ãŠã‚Šã€ä¸‹è¨˜ãŒæ–™é‡‘ãƒ†ãƒ¼ãƒ–ãƒ«ã«ãªã‚Šã¾ã™ã€‚

[https://www.alibabacloud.com/product/machine-learning/pricing](https://www.alibabacloud.com/product/machine-learning/pricing)
